{"openapi":"3.1.0","info":{"title":"Honoua API","version":"0.1.0"},"paths":{"/health":{"get":{"summary":"Health","operationId":"health_health_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/api/products":{"get":{"summary":"List Products","description":"Retourne la liste statique (smoke test).","operationId":"list_products_api_products_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"items":{"$ref":"#/components/schemas/Product"},"type":"array","title":"Response List Products Api Products Get"}}}}}}},"/api/products/{ean}":{"get":{"summary":"Get Product","description":"Lecture en BDD (si présente), sinon fallback mémoire.","operationId":"get_product_api_products__ean__get","parameters":[{"name":"ean","in":"path","required":true,"schema":{"type":"string","title":"Ean"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Product"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/products/search":{"post":{"summary":"Search Products","description":"Recherche très simple par nom. On tente la BDD d'abord (full scan),\nsinon on revient au fallback mémoire.","operationId":"search_products_api_products_search_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ProductSearchQuery"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"items":{"$ref":"#/components/schemas/Product"},"type":"array","title":"Response Search Products Api Products Search Post"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/compare":{"post":{"summary":"Compare Products","description":"Endpoint de comparaison carbone minimal (valeurs null pour préparer le front).","operationId":"compare_products_api_compare_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CompareRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/CompareResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/emissions/calc":{"post":{"tags":["emissions"],"summary":"Calc Emissions","description":"A36 — Calcul réel + idempotence:\n- Sélection facteur\n- Normalisation\n- Calcul\n- UPSERT par idempotency_key (retourne la ligne existante si déjà insérée)","operationId":"calc_emissions_emissions_calc_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/EmissionCalcIn"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/EmissionCalcOut"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/emissions/history":{"get":{"tags":["emissions"],"summary":"Get Emissions History","description":"A36 — Historique minimal des calculs.\n- Filtres: product_id, category_code, session_id, date_from, date_to\n- Tri: plus récents d'abord\n- Limit: 50 par défaut","operationId":"get_emissions_history_emissions_history_get","parameters":[{"name":"product_id","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Product Id"}},{"name":"category_code","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Category Code"}},{"name":"session_id","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Session Id"}},{"name":"date_from","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Date From"}},{"name":"date_to","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Date To"}},{"name":"limit","in":"query","required":false,"schema":{"type":"integer","default":50,"title":"Limit"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/EmissionHistoryItem"},"title":"Response Get Emissions History Emissions History Get"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/products":{"get":{"tags":["products"],"summary":"List Products","operationId":"list_products_products_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/products/{ean}":{"get":{"tags":["products"],"summary":"Get Product","operationId":"get_product_products__ean__get","parameters":[{"name":"ean","in":"path","required":true,"schema":{"type":"string","title":"Ean"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/products/search":{"post":{"tags":["products"],"summary":"Search Products","operationId":"search_products_products_search_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/app__main__ProductSearchIn"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/compare":{"post":{"tags":["compare"],"summary":"Compare Products","operationId":"compare_products_compare_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CompareIn"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/emissions/history_a37":{"get":{"tags":["emissions"],"summary":"Time-aggregated emissions (JSON or CSV)","operationId":"get_emissions_history_emissions_history_a37_get","parameters":[{"name":"from_","in":"query","required":false,"schema":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"From "}},{"name":"to","in":"query","required":false,"schema":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"To"}},{"name":"interval","in":"query","required":true,"schema":{"$ref":"#/components/schemas/Interval"}},{"name":"group_by","in":"query","required":false,"schema":{"$ref":"#/components/schemas/GroupBy","default":"none"}},{"name":"scope","in":"query","required":false,"schema":{"enum":["user","org"],"type":"string","default":"user","title":"Scope"}},{"name":"scope_id","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Scope Id"}},{"name":"normalize","in":"query","required":false,"schema":{"$ref":"#/components/schemas/Normalize","default":"none"}},{"name":"tz","in":"query","required":false,"schema":{"type":"string","default":"Europe/Paris","title":"Tz"}},{"name":"limit","in":"query","required":false,"schema":{"type":"integer","default":366,"title":"Limit"}}],"requestBody":{"content":{"application/json":{"schema":{"anyOf":[{"type":"array","items":{"$ref":"#/components/schemas/Metric"}},{"type":"null"}],"title":"Metrics"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HistoryResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}}},"components":{"schemas":{"CompareIn":{"properties":{"eans":{"items":{"type":"string"},"type":"array","title":"Eans"}},"type":"object","required":["eans"],"title":"CompareIn"},"CompareItemResult":{"properties":{"ean":{"type":"string","title":"Ean"},"carbon_kgCO2e":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Carbon Kgco2E"}},"type":"object","required":["ean"],"title":"CompareItemResult"},"CompareRequest":{"properties":{"eans":{"items":{"type":"string"},"type":"array","title":"Eans"}},"type":"object","required":["eans"],"title":"CompareRequest"},"CompareResponse":{"properties":{"results":{"items":{"$ref":"#/components/schemas/CompareItemResult"},"type":"array","title":"Results"}},"type":"object","required":["results"],"title":"CompareResponse"},"DataPoint":{"properties":{"t":{"type":"string","format":"date-time","title":"T"},"sum":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Sum"},"avg":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Avg"},"count":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Count"},"min":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Min"},"max":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Max"},"group":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Group"}},"type":"object","required":["t"],"title":"DataPoint"},"EmissionCalcIn":{"properties":{"product_id":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Product Id","description":"UUID produit ou EAN"},"category_code":{"type":"string","title":"Category Code","description":"Code catégorie ex. 'BOISSONS_LIMONADE'"},"quantity":{"type":"number","exclusiveMinimum":0.0,"title":"Quantity","description":"Quantité telle que scannée/saisie"},"quantity_unit":{"type":"string","title":"Quantity Unit","description":"g | kg | ml | l | piece"},"session_id":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Session Id","description":"UUID session (facultatif)"},"idempotency_key":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Idempotency Key","description":"Clé idempotence optionnelle"}},"type":"object","required":["category_code","quantity","quantity_unit"],"title":"EmissionCalcIn"},"EmissionCalcOut":{"properties":{"id":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Id"},"emissions_gco2e":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Emissions Gco2E"},"factor":{"anyOf":[{"$ref":"#/components/schemas/FactorInfo"},{"type":"null"}]},"normalized_qty":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Normalized Qty"},"method":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Method"},"created_at":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Created At"},"session_id":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Session Id"},"note":{"type":"string","title":"Note","default":"A36: endpoint squelette — logique à implémenter (Étapes suivantes)."}},"type":"object","title":"EmissionCalcOut"},"EmissionHistoryItem":{"properties":{"id":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Id"},"emissions_gco2e":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Emissions Gco2E"},"factor":{"anyOf":[{"$ref":"#/components/schemas/FactorInfo"},{"type":"null"}]},"normalized_qty":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Normalized Qty"},"method":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Method"},"created_at":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Created At"},"session_id":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Session Id"},"note":{"type":"string","title":"Note","default":"A36: endpoint squelette — logique à implémenter (Étapes suivantes)."},"product_id":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Product Id"},"category_code":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Category Code"},"quantity":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Quantity"},"quantity_unit":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Quantity Unit"}},"type":"object","title":"EmissionHistoryItem"},"FactorInfo":{"properties":{"id":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Id"},"unit":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Unit"},"value":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Value"},"version":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Version"},"source":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Source"}},"type":"object","title":"FactorInfo"},"GroupBy":{"type":"string","enum":["none","category","store","brand","product"],"title":"GroupBy"},"HTTPValidationError":{"properties":{"detail":{"items":{"$ref":"#/components/schemas/ValidationError"},"type":"array","title":"Detail"}},"type":"object","title":"HTTPValidationError"},"HistoryResponse":{"properties":{"interval":{"$ref":"#/components/schemas/Interval"},"from":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"From"},"to":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"To"},"group_by":{"$ref":"#/components/schemas/GroupBy"},"series":{"items":{"$ref":"#/components/schemas/DataPoint"},"type":"array","title":"Series"},"summary":{"$ref":"#/components/schemas/HistorySummary"},"export_ready":{"type":"boolean","title":"Export Ready","default":true}},"type":"object","required":["interval","group_by","series","summary"],"title":"HistoryResponse"},"HistorySummary":{"properties":{"sum_total":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Sum Total"},"trend_slope_per_interval":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Trend Slope Per Interval"},"count_points":{"type":"integer","title":"Count Points"}},"type":"object","required":["count_points"],"title":"HistorySummary"},"Interval":{"type":"string","enum":["day","week","month"],"title":"Interval"},"Metric":{"type":"string","enum":["sum","avg","count","min","max"],"title":"Metric"},"Normalize":{"type":"string","enum":["none","per_unit","per_euro"],"title":"Normalize"},"Product":{"properties":{"ean":{"type":"string","title":"Ean"},"name":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Name"},"category":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Category"}},"type":"object","required":["ean"],"title":"Product"},"ProductSearchQuery":{"properties":{"q":{"type":"string","title":"Q"}},"type":"object","required":["q"],"title":"ProductSearchQuery"},"ValidationError":{"properties":{"loc":{"items":{"anyOf":[{"type":"string"},{"type":"integer"}]},"type":"array","title":"Location"},"msg":{"type":"string","title":"Message"},"type":{"type":"string","title":"Error Type"}},"type":"object","required":["loc","msg","type"],"title":"ValidationError"},"app__main__ProductSearchIn":{"properties":{"q":{"type":"string","title":"Q"}},"type":"object","required":["q"],"title":"ProductSearchIn"}}}}